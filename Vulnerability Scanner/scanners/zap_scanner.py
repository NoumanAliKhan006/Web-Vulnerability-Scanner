import requests
import time

def scan_with_zap(url):
    """Run OWASP ZAP scanner and return the results."""
    zap_base_url = "http://localhost:8080"
    api_key = "enter your zap api key here"

    # Start ZAP spider
    spider_url = f"{zap_base_url}/JSON/spider/action/scan/?apikey={api_key}&url={url}"
    response = requests.get(spider_url)
    scan_id = response.json()["scan"]

    # Wait for spider to complete
    while int(requests.get(f"{zap_base_url}/JSON/spider/view/status/?apikey={api_key}&scanId={scan_id}").json()["status"]) < 100:
        time.sleep(5)

    # Start active scan
    active_scan_url = f"{zap_base_url}/JSON/ascan/action/scan/?apikey={api_key}&url={url}"
    response = requests.get(active_scan_url)
    scan_id = response.json()["scan"]

    # Wait for active scan to complete
    while int(requests.get(f"{zap_base_url}/JSON/ascan/view/status/?apikey={api_key}&scanId={scan_id}").json()["status"]) < 100:
        time.sleep(5)

    # Get results
    results_url = f"{zap_base_url}/JSON/core/view/alerts/?apikey={api_key}&baseurl={url}"
    results = requests.get(results_url).json()
    return results

if __name__ == "__main__":
    target_url = "http://example.com"
    zap_results = scan_with_zap(target_url)
    print(zap_results)
